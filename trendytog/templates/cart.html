
{% extends 'base.html' %}
{% load static %}

{% block metadescription %}
This is the cart page. Proceed to review your cart items and place the order.
{% endblock %}

{% block title %}
Cart – Trendytog
{% endblock %}

{% block content %}

{% if not cart_items %}
<div class="text-center">
    <br>
    <h1 class="my_title">Your Shopping Cart Is Empty!</h1>
    <p>Please click <a href="{% url 'home:allprodcat' %}">Here</a> to continue shopping.</p>
</div>

{% else %}

<div class="text-center">
    <h1 class="my_title">Your Shopping Cart</h1>
</div>

<div class="row mx-auto">
    <div class="col-lg-6 col-12 text-center">

        <table class="table my_custom_table">
            <thead class="my_custom_thead">
                <tr>
                    <th colspan="5">Your Items</th>
                </tr>
            </thead>

            <tbody>
                {% for cart_item in cart_items %}
                <tr>
                    <td>
                        <a href="{{ cart_item.product.get_absolute_url }}">
                            <img src="{{ cart_item.product.image.url }}" class="float-left rounded custom_image" alt="">
                        </a>
                    </td>

                    <td class="text-left">
                        {{ cart_item.product.name }} <br>
                        SKU: {{ cart_item.product.id }} <br>
                        Price: ${{ cart_item.product.price }} <br>
                        Quantity: {{ cart_item.quantity }} × {{ cart_item.product.price }}
                    </td>

                    <td>
                        ${{ cart_item.sub_total }}
                    </td>

                    <td>
                        {% if cart_item.quantity < cart_item.product.stock %}
                            <a href="{% url 'cart:add_cart' cart_item.product.id %}" class="custom_icon">
                                <i class="fa-solid fa-plus"></i>
                            </a>
                        {% endif %}

                        <a href="{% url 'cart:cart_remove' cart_item.product.id %}" class="custom_icon">
                            <i class="fa-solid fa-minus"></i>
                        </a>

                        <a href="{% url 'cart:full_remove' cart_item.product.id %}" class="custom_icon">
                            <i class="fa-solid fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <br>

        <table class="table my_custom_table">
            <thead class="my_custom_thead">
                <tr><th>Checkout</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td>Please review your shopping cart items before proceeding with payment.</td>
                </tr>

                <tr>
                    <td>
                        <a href="{% url 'cart:checkout' %}" id="rzp-button1" class="btn btn-success">
                           Pay with Razorpay
                        </a>

                       
                    </td>
                </tr>
            </tbody>
        </table>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <script>
        var options = {
            "key": "{{ razorpay_key }}",
            "amount": "{{ payment.amount }}",
            "currency": "INR",
            "name": "My Django Shop",
            "description": "Cart Payment",
            "order_id": "{{ payment.id }}",
            "handler": function (response) {
                window.location.href = "/cart/paymentsuccess/?order_id={{ order.id }}&payment_id="
                    + response.razorpay_payment_id + "&signature=" + response.razorpay_signature;
            },
            "theme": {
                "color": "#528FF0"
            }
        };

        var rzp1 = new Razorpay(options);
        document.getElementById("rzp-button1").onclick = function (e) {
            rzp1.open();
            e.preventDefault();
        }
        </script>

        <br>
        <a class="btn btn-secondary btn-block my_custom_button" href="{% url 'home:allprodcat' %}">
            Continue Shopping
        </a>

    </div>
</div>

{% endif %}

{% endblock %}








